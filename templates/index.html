<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê°ì • ë¶„ë¥˜ ì›¹ì•±</title>
    <style>
        .negative {
            background-color: lightblue;
            border: 1px solid blue; /* ë¶€ì •ì  ë¬¸ì¥ í…Œë‘ë¦¬ ì¶”ê°€ */
            padding: 5px; /* ë‚´ë¶€ ì—¬ë°± ì¶”ê°€ */
            margin: 2px; /* ì™¸ë¶€ ì—¬ë°± ì¶”ê°€ */
        }
        .neutral {
            background-color: rgb(255, 255, 255);
            border: 1px solid rgb(182, 181, 181); /* ì¤‘ë¦½ì  ë¬¸ì¥ í…Œë‘ë¦¬ ì¶”ê°€ */
            padding: 5px;
            margin: 2px;
        }
        .positive {
            background-color: rgb(189, 255, 122);
            border: 1px solid green; /* ê¸ì •ì  ë¬¸ì¥ í…Œë‘ë¦¬ ì¶”ê°€ */
            padding: 5px;
            margin: 2px;
        }
        .sentence {
            display: inline-block; /* span íƒœê·¸ë¥¼ ë¸”ë¡ ìš”ì†Œì²˜ëŸ¼ í‘œì‹œ */
        }
    </style>
</head>
<body>
    <div style="text-align:center; margin-top:50px;">
        <h1>ê°ì • ë¶„ë¥˜</h1>
    </div>
    <div style="text-align:center; margin-top:50px;">
        <textarea id="inputText" placeholder="ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”" rows="4" cols="50"></textarea>
        <br>
        <button onclick="sendText()">ë¶„ì„</button>
        <button onclick="startRecognition()">ğŸ™ï¸</button>
        <div id="result"></div>
    </div>
    <script>
        let recognition;
        let analysisData = []; // ë¶„ì„ ê²°ê³¼ë¥¼ ì €ì¥í•  ë³€ìˆ˜

        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'ko-KR';
            recognition.onresult = function(event) {
                let transcript = event.results[0][0].transcript;
                document.getElementById("inputText").value = transcript;
            }
        } else {
            alert("ìŒì„± ì¸ì‹ì´ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.");
        }

        function startRecognition(){
            if(recognition) recognition.start();
        }

        function sendText(){
            const text = document.getElementById("inputText").value;
            fetch('/classify', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({text: text})
            }).then(response => response.json())
            .then(data => {
                analysisData = data; // ë¶„ì„ ê²°ê³¼ ì €ì¥
                updateResult();
            });
        }

        function updateResult() {
            let resultHtml = "";
            let negativeCount = 0;
            let neutralCount = 0;
            let positiveCount = 0;

            analysisData.forEach((item, index) => {
                let sentenceClass = "";
                if (item.label === "ë¶€ì •ì ") {
                    sentenceClass = "negative";
                    negativeCount++;
                } else if (item.label === "ì¤‘ë¦½") {
                    sentenceClass = "neutral";
                    neutralCount++;
                } else {
                    sentenceClass = "positive";
                    positiveCount++;
                }
                resultHtml += `<span class="${sentenceClass} sentence" data-index="${index}">${item.sentence} </span>`;
            });

            document.getElementById("result").innerHTML = resultHtml + `<br><br><b>ìµœì¢… ê²°ê³¼:</b><br>ë¶€ì •: ${negativeCount}ê°œ, ì¤‘ë¦½: ${neutralCount}ê°œ, ê¸ì •: ${positiveCount}ê°œ`;

            // ë¬¸ì¥ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            document.querySelectorAll(".sentence").forEach(sentence => {
                sentence.addEventListener("click", function(event) {
                    const index = this.dataset.index;
                    const rect = this.getBoundingClientRect();
                    const options = document.createElement("div");
                    options.style.position = "absolute";
                    options.style.left = `${rect.left}px`;
                    options.style.top = `${rect.bottom + window.scrollY + 5}px`; // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ê³ ë ¤ ë° ì•½ê°„ì˜ ì—¬ë°± ì¶”ê°€
                    options.style.border = "1px solid #ccc";
                    options.style.backgroundColor = "white";
                    options.innerHTML = `<button data-action="negative">ë¶€ì •</button><button data-action="neutral">ì¤‘ë¦½</button><button data-action="positive">ê¸ì •</button>`;
                    document.body.appendChild(options);

                    // ì˜µì…˜ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                    options.querySelectorAll("button").forEach(button => {
                        button.addEventListener("click", function() {
                            const action = this.dataset.action;
                            let newClass = "";
                            if (action === "negative") {
                                newClass = "negative";
                                analysisData[index].label = "ë¶€ì •ì ";
                            } else if (action === "neutral") {
                                newClass = "neutral";
                                analysisData[index].label = "ì¤‘ë¦½";
                            } else {
                                newClass = "positive";
                                analysisData[index].label = "ê¸ì •ì ";
                            }
                            sentence.className = `sentence ${newClass}`;
                            document.body.removeChild(options);
                            updateResult(); // ê²°ê³¼ ì—…ë°ì´íŠ¸
                        });
                    });

                    // ì™¸ë¶€ í´ë¦­ ì‹œ ì˜µì…˜ ì œê±°
                    function removeOptions(event) {
                        if (!options.contains(event.target) && event.target !== sentence) {
                            document.body.removeChild(options);
                            document.removeEventListener("click", removeOptions);
                        }
                    }
                    document.addEventListener("click", removeOptions);
                });
            });
        }
    </script>
</body>
</html>